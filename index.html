<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Learn Python Step-by-Step</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js?cb=2"></script>
  <style>
    body { font-family: sans-serif; background: #f4fbfb; padding: 2em; }
    .container { max-width: 960px; margin: auto; }
    .step-header { display: flex; justify-content: space-between; margin-bottom: 1em; }
    .instructions { background: #ffffff; padding: 1em; border-radius: 8px; margin-bottom: 1em; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .editor { background: #1e1e1e; padding: 1em; border-radius: 8px; color: white; font-family: monospace; margin-bottom: 1em; }
    textarea { width: 100%; height: 120px; font-size: 1em; background: #1e1e1e; color: white; border: none; resize: vertical; }
    .output { background: #fff; border: 1px dashed #ccc; min-height: 150px; padding: 1em; margin-top: 1em; border-radius: 8px; white-space: pre-wrap; }
    .canvas { background: #fff; border: 1px solid #ccc; margin-top: 1em; width: 100%; height: 300px; border-radius: 8px; }
    button { padding: 0.5em 1.5em; margin: 0.5em; font-size: 1em; border: none; border-radius: 6px; cursor: pointer; background: #3c82f6; color: white; }
    button:hover { background: #255ec1; }
  </style>
</head>
<body>
<div class="container">
  <div class="step-header">
    <h2 id="step-title">Step 1 / 1</h2>
    <button onclick="nextStep()">Next Step ▶</button>
  </div>

  <div class="instructions" id="instruction-box">
    Loading instructions...
  </div>

  <div class="editor">
    <textarea id="code-area">print("Hello, Python!")</textarea>
  </div>

  <button onclick="runCode()">Run Code</button>
  <div class="output" id="output">Code output will appear here.</div>
  <canvas class="canvas" id="canvas"></canvas>
</div>

<script>
  let pyodideReady = loadPyodide();
  let currentStep = 0;

  const steps = [
    {
      title: "Step 1 / 2",
      instruction: `You're going to build a painting app!\n\nStart by placing a dot using x and y coordinates. Try changing the numbers to see how it moves.`,
      defaultCode: `x = 100\ny = 100\nfrom js import document\nctx = document.getElementById("canvas").getContext("2d")\nctx.fillStyle = "black"\nctx.beginPath()\nctx.arc(x, y, 5, 0, 3.14*2)\nctx.fill()`
    },
    {
      title: "Step 2 / 2",
      instruction: `Now try placing multiple dots by changing the coordinates multiple times!`,
      defaultCode: `coords = [(50, 60), (150, 120), (250, 80)]\nfrom js import document\nctx = document.getElementById("canvas").getContext("2d")\nctx.fillStyle = "blue"\nfor x, y in coords:\n    ctx.beginPath()\n    ctx.arc(x, y, 5, 0, 3.14*2)\n    ctx.fill()`
    }
  ];

  async function runCode() {
    const output = document.getElementById("output");
    const code = document.getElementById("code-area").value;
    const pyodide = await pyodideReady;
    output.textContent = "Running...";

    try {
      await pyodide.runPythonAsync(`import sys, io\nsys.stdout = io.StringIO()\nsys.stderr = sys.stdout`);
      await pyodide.runPythonAsync(code);
      const result = await pyodide.runPythonAsync("sys.stdout.getvalue()");
      output.textContent = result || "✓ Code ran with no output.";
    } catch (err) {
      output.textContent = "❌ Error:\n" + err;
    }
  }

  function nextStep() {
    currentStep = (currentStep + 1) % steps.length;
    loadStep(currentStep);
  }

  function loadStep(index) {
    const step = steps[index];
    document.getElementById("step-title").textContent = step.title;
    document.getElementById("instruction-box").textContent = step.instruction;
    document.getElementById("code-area").value = step.defaultCode;
    document.getElementById("output").textContent = "Code output will appear here.";
    const canvas = document.getElementById("canvas");
    canvas.getContext("2d").clearRect(0, 0, canvas.width, canvas.height);
  }

  loadStep(currentStep);
</script>
</body>
</html>
